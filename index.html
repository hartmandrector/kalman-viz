<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalman Filter Optimization Viewer</title>
  <link rel="stylesheet" href="/src/style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Kalman Filter Optimization Results Viewer</h1>
      <p>Load optimizer metadata JSON, parameter JSON, or CSV files to visualize results</p>
    </header>

    <section class="file-loader">
      <div class="drop-zone" id="dropZone">
        <p>üìÅ Drag & drop files here or click to browse</p>
        <input type="file" id="fileInput" multiple accept=".json,.csv" style="display: none;">
      </div>
      <button id="browseBtn" class="btn-primary">Browse Files</button>
      <button id="clearBtn" class="btn-secondary">Clear All</button>
    </section>

    <section class="file-list" id="fileList">
      <h3>Loaded Files (<span id="fileCount">0</span>)</h3>
      <ul id="fileListItems"></ul>
    </section>

    <section class="controls">
      <h3>Parameter Plot Controls</h3>
      <div class="control-group">
        <label for="xAxis">X-Axis:</label>
        <select id="xAxis">
          <option value="">-- Select X-Axis --</option>
        </select>
      </div>
      <div class="control-group">
        <label for="yAxis">Y-Axis:</label>
        <select id="yAxis" multiple size="5">
          <option value="">-- Select Y-Axis (multi-select) --</option>
        </select>
      </div>
      <button id="plotBtn" class="btn-primary">Update Plot</button>
    </section>

    <section class="chart-container">
      <canvas id="chart"></canvas>
    </section>

    <section class="csv-controls" id="csvControls" style="display: none;">
      <h3>CSV Time Series</h3>
      <div class="control-group">
        <label for="dataTypeFilter">Data Type Filter:</label>
        <select id="dataTypeFilter" multiple size="4">
          <option value="">-- Select Data Types --</option>
        </select>
      </div>
      <div class="control-group">
        <label for="csvColumns">Columns to Plot:</label>
        <select id="csvColumns" multiple size="5">
          <option value="">-- Select Columns --</option>
        </select>
      </div>
      <button id="plotCsvBtn" class="btn-primary">Plot CSV Time Series</button>
    </section>

    <section class="chart-container">
      <canvas id="csvChart"></canvas>
    </section>

    <section class="gps-error-controls" id="gpsErrorControls" style="display: none;">
      <h3>GPS Error Comparison</h3>
      <div class="control-group">
        <label for="gpsErrorFiles">GPS Error Files to Compare:</label>
        <select id="gpsErrorFiles" multiple size="5">
        </select>
      </div>
      <button id="compareGpsBtn" class="btn-primary">Compare GPS Errors</button>
      <button id="exportGpsErrorsBtn" class="btn-secondary">Export Comparison CSV</button>
    </section>

    <section class="chart-container">
      <canvas id="gpsErrorChart"></canvas>
    </section>

    <section class="correlation-controls" id="correlationControls" style="display: none;">
      <h3>Parameter Correlation Analysis</h3>
      <p class="info-text">Loaded <span id="sweepCount">0</span> sweep(s) with <span id="runCount">0</span> total runs</p>
      <div class="control-group">
        <label for="correlationX">GPS Error Dimension:</label>
        <select id="correlationX">
          <option value="">-- Select GPS Error Dimension --</option>
        </select>
      </div>
      <div class="control-group">
        <label for="correlationY">Output Parameter:</label>
        <select id="correlationY">
          <option value="">-- Select Output Parameter --</option>
        </select>
      </div>
      <button id="plotCorrelationBtn" class="btn-primary">Plot Correlation</button>
      <button id="showTopCorrelationsBtn" class="btn-secondary">Show Top Correlations</button>
      <div id="correlationInfo" class="correlation-info" style="display: none;">
        <p><strong>Correlation Coefficient:</strong> <span id="correlationCoeff">-</span></p>
        <p><strong>R¬≤ (Linear Fit):</strong> <span id="rSquared">-</span></p>
        <p><strong>Linear Model:</strong> <span id="linearEquation">-</span></p>
      </div>
    </section>

    <section class="chart-container">
      <canvas id="correlationChart"></canvas>
    </section>

    <section class="prediction-controls" id="predictionControls" style="display: none;">
      <h3>Parameter Prediction</h3>
      <p class="info-text">Select a GPS error file to predict optimal parameters</p>
      <div class="control-group">
        <label for="predictionGpsFile">GPS Error File:</label>
        <select id="predictionGpsFile">
          <option value="">-- Select GPS Error File --</option>
        </select>
      </div>
      <button id="predictParametersBtn" class="btn-primary">Predict Parameters</button>
      <div id="predictionResults" class="prediction-results" style="display: none;">
        <h4>Predicted Parameters:</h4>
        <table id="predictionTable">
          <thead>
            <tr>
              <th>Parameter</th>
              <th>Predicted Value</th>
              <th>Based On</th>
              <th>Model R¬≤</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button id="exportPredictionBtn" class="btn-secondary">Export Predicted Parameters</button>
      </div>
    </section>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
